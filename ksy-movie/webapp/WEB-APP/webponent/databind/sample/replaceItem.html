<!DOCTYPE html>
<html lang="ko">
<head>
<link rel="stylesheet" type="text/css" href="/WEB-APP/webponent/thirdParty/codemirror/codemirror.css" /><script type="text/javascript" src="/WEB-APP/webponent/thirdParty/codemirror/codemirror.js"></script><script type="text/javascript" src="/WEB-APP/webponent/thirdParty/codemirror/xml.js"></script><script type="text/javascript" src="/WEB-APP/webponent/thirdParty/codemirror/javascript.js"></script><script type="text/javascript" src="/WEB-APP/webponent/thirdParty/codemirror/css.js"></script><script type="text/javascript" src="/WEB-APP/webponent/thirdParty/codemirror/htmlmixed.js"></script><link rel="stylesheet" type="text/css" href="sample.css">
<script type="text/javascript" src="/WEB-APP/webponent/thirdParty/jquery/jquery-1.9.1.min.js"></script><script type="text/javascript" src="sample.js"></script>

<script type="text/javascript" src="/WEB-APP/webponent/databind/databind.js"></script>
<script type="text/javascript" src="/WEB-APP/webponent/websocket/websocketinfo.js"></script>
<script type="text/javascript" src="/WEB-APP/webponent/websocket/web_socket.js"></script>

<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
<title>Insert title here</title>
</head>
<body onunload="try{SOCKET.close();}catch(e){}">
<div id="description">
<div class="description-item">
    <div class="fl bind-attribute">data-bind="_this.listItem(a.block)^_this.replaceItem(x21,x21.autocode)"</div>
    <div class="fr bind-target">TARGET : 바인더 하위의 TBODY, UL, OL Element</div>
    <div class="clear"></div>
    <div class="bind-description">
        &lt;tbody data-bind="<strong>_this.listItem(a.block)^_this.replaceItem(x21,x21.autocode)</strong>"&gt;<br/>
        <ol>
            <li>&lt;tr <strong>data-bindkeyvalue="005930"</strong>"&gt;...&lt;/tr&gt;</li>
            <li>&lt;tr <strong>bindkey="jongcode"</strong>"&gt;...&lt;/tr&gt;</li>
            <li>&lt;tr "&gt;...&lt;/tr&gt;</li>
        </ol>
                &lt;/tbody&gt;
        <div>
            <p>LIST data의 row단위를 실시간으로 갱신한다. 실시간으로 넘어오는 데이터를 알맞은 ROW의 데이터에 바인딩시키기 위해서는 <strong>data-bindkeyvalue</strong>가 설정되어야 한다. 
            replaceItem의 2번째 인자인 autocode는 실시간 데이터에 항상 넘어 오며 이는 실시간 등록시에 입력한 코드 값이다. 이 값과 data-bindkeyvalue에 설정된 값이 같은경우 실시간적용 대상이 된다.
            즉, 2번째 인자인 autocode는 지금 현재 들어온 실시간 데이터가 어떤 code인지를 알려주는 값이며 이 값과 data-bindkeyvalue가 같은 ROW를 찾아 안쪽에 binding을 수행한다.
            </p>
            <ul>
                <li>1 번의 같이 listItem을 사용하지 않는경우(static, withItem)  data-bindkeyvalue를 코드값으로 설정한다. (이미 종목코드를 알고 있는 경우 수동으로 세팅)</li>
                <li>2 번과 같이 bindkey로 설정하는 방법은 a.block을 listItem으로 처리 하면서 내부적으로 a.block[순번].jongcode값을 data-bindkeyvalue로 자동 세팅한다.</li>
                <li>3 번과 같이 data-bindkey 또는 data-bindkeyvalue가 셋팅되지 않은경우 실시간은 skip된다.</li>
            </ul>
        </div>
    </div>
</div>
</div>
<div id="preview" class="preview"></div><div id="htmlview"><textarea id="html" name="html" style="display: none;"><form id="frm">
    <div class="div-layout two">
	    <div class="first">
	        <h2>replaceItem</h2>
	        <table style="width:100%">
                <caption>withItem과 replaceItem (data-bindkey, bindkeyvalue, 하이닉스 스킵)</caption>
                <thead>
                    <tr>
                        <th scope="col">날짜</th>
                        <th scope="col">현재가</th>
                        <th scope="col">전일비</th>
                        <th scope="col">등락율</th>
                        <th scope="col">거래량</th>
                    </tr>
                </thead>
                <tbody data-bind="_this.withItem(a,false)^_this.replaceItem(x21,x21.autocode)">
                    <tr data-bindkey="block[0].jongcode">
                        <td data-bind="block[0].jongname"></td>
                        <td data-bind="block[0].curjuka^curjuka"></td>
                        <td data-bind="DB_getColFlag(block[0].debi,block[0].debi_f)^DB_getColFlag(debi,debi_f)"></td>
                        <td data-bind="DB_getColBuho(block[0].debirate)^DB_getColBuho(debirate)"></td>
                        <td data-bind="block[0].volume^volume"></td>
                    </tr>
                    <tr data-bindkeyvalue="122630" class="even">
                        <td data-bind="block[1].jongname"></td>
                        <td data-bind="block[1].curjuka^curjuka"></td>
                        <td data-bind="DB_getColFlag(block[1].debi,block[1].debi_f)^DB_getColFlag(debi,debi_f)"></td>
                        <td data-bind="DB_getColBuho(block[1].debirate)^DB_getColBuho(debirate)"></td>
                        <td data-bind="block[1].volume^volume"></td>
                    </tr>
                    <tr>
                        <td data-bind="block[2].jongname"></td>
                        <td data-bind="block[2].curjuka^curjuka"></td>
                        <td data-bind="DB_getColFlag(block[2].debi,block[2].debi_f)^DB_getColFlag(debi,debi_f)"></td>
                        <td data-bind="DB_getColBuho(block[2].debirate)^DB_getColBuho(debirate)"></td>
                        <td data-bind="block[2].volume^volume"></td>
                    </tr>
                </tbody>
            </table>
	    </div>
	    <div>
	        <h2>replaceItem</h2>
	        <table style="width:100%">
                <caption>listItem과 replaceItem (data-bindkey를 사용)</caption>
                <thead>
                    <tr>
                        <th scope="col">시간</th>
                        <th scope="col">현재가</th>
                        <th scope="col">전일비</th>
                        <th scope="col">등락율</th>
                        <th scope="col">체결량</th>
                    </tr>
                </thead>
                <tbody data-bind="_this.listItem(a.block)^_this.replaceItem(r,r.autocode)" data-realtime-color="true">
                    <tr data-bindkey="jongcode">
                        <td data-bind="jongname"></td>
                        <td data-bind="curjuka^curjuka"></td>
                        <td data-bind="DB_getColFlag(debi,debi_f)^DB_getColFlag(debi,debi_f)"></td>
                        <td data-bind="DB_getColBuho(debirate)^DB_getColBuho(debirate)"></td>
                        <td data-bind="volume^volume"></td>
                    </tr>
                </tbody>
            </table>
	    </div>
    </div>
</form></textarea></div>

<div id="scriptview"><textarea id="script" name="script" style="display: none;"><script type="text/javascript">
    //임시 데이터
    var jsonData = {
        a:{
            block:[
                {jongcode:"005930",jongname:"삼성전자",curjuka:"1,137,000",debi:"10,000",debi_f:"2",debirate:"0.67",volume:"58,948",medohoka:"1,151,000",medojan:"1",mesuhoka:"1,150,000",mesujan:"135"},
                {jongcode:"122630",jongname:"KODEX 레버리지",curjuka:"12,120",debi:"135",debi_f:"5",debirate:"-1.13",volume:"11,600,333",medohoka:"9,130",medojan:"385",mesuhoka:"9,125",mesujan:"8235"},
                {jongcode:"000660",jongname:"SK하이닉스",curjuka:"31,700",debi:"300",debi_f:"2",debirate:"0.96",volume:"1,323,825",medohoka:"27,450",medojan:"825",mesuhoka:"27,000",mesujan:"185"}
            ]
        }
    };

    var formId = "frm";
    
    var binder = manager.addBinder(formId,true);//해당 폼을 매니저에 등록
    binder.bind(jsonData);//jsonData를 해당 element에 binding
    
    
    
    
    //실시간 데이터 수신을 위한 웹소켓 연결
    startWebsocket();//websocketinfo.js
    
    //실시간 등록,해제함수  ([+|-],[실시간등록코드], [폼아이디], [실시간수신TR])
    var block = jsonData.a.block;
    var sendList = new Array();
    for( var i = 0, ic = block.length; i < ic; i++ ){
        sendList.push(block[i]["jongcode"]);
    }
    
	
    manager.send("+",sendList.join("|"),formId,"x21");
</script></textarea></div><div class="clear"></div></body></html>