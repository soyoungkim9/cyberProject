<!DOCTYPE html>
<html lang="ko">
<head>
<link rel="stylesheet" type="text/css" href="/WEB-APP/webponent/thirdParty/codemirror/codemirror.css" /><script type="text/javascript" src="/WEB-APP/webponent/thirdParty/codemirror/codemirror.js"></script><script type="text/javascript" src="/WEB-APP/webponent/thirdParty/codemirror/xml.js"></script><script type="text/javascript" src="/WEB-APP/webponent/thirdParty/codemirror/javascript.js"></script><script type="text/javascript" src="/WEB-APP/webponent/thirdParty/codemirror/css.js"></script><script type="text/javascript" src="/WEB-APP/webponent/thirdParty/codemirror/htmlmixed.js"></script><link rel="stylesheet" type="text/css" href="sample.css">
<script type="text/javascript" src="/WEB-APP/webponent/thirdParty/jquery/jquery-1.9.1.min.js"></script><script type="text/javascript" src="sample.js"></script>

<script type="text/javascript" src="/WEB-APP/webponent/databind/databind.js"></script>
<script type="text/javascript" src="/WEB-APP/webponent/websocket/websocketinfo.js"></script>
<script type="text/javascript" src="/WEB-APP/webponent/websocket/web_socket.js"></script>

<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
<title>Insert title here</title>
</head>
<body onunload="try{SOCKET.close();}catch(e){}">
<div id="description">
<div class="description-item">
    <div class="fl bind-attribute">data-realtime-zone="realtimezoneId"</div>
    <div class="fr bind-target">TARGET : 바인더 하위의 bind된 element를 감싸는 모든 Element </div>
    <div class="clear"></div>
    <div class="bind-description">
    
	    <div class="div-layout two">
	        <div class="first">
	            &lt;form id="frm"&gt;<br/>
	    
			    &nbsp;&nbsp;&nbsp;&nbsp;&lt;tbody data-bind="^_this.prependItem(x21)"&gt;<br/>
	            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....<br/>
	            &nbsp;&nbsp;&nbsp;&nbsp;&lt;/tbody&gt;<br/>
			    
			    <br/><br/>
			    &nbsp;&nbsp;&nbsp;&nbsp;&lt;tbody data-bind="^_this.replaceItem(x22,x22.autocode)"&gt;<br/>
			    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....<br/>
			    &nbsp;&nbsp;&nbsp;&nbsp;&lt;/tbody&gt;<br/>
			    
			    
			    &lt;/form&gt;<br/><br/>
			    <strong>manager.send("+","005930",formId,"x21|x22");</strong>
	        </div>
	        <div>
	            &lt;form id="frm"&gt;<br/>
	    
			    &nbsp;&nbsp;&nbsp;&nbsp;&lt;div <strong>data-realtime-zone="chegyul-table"</strong>&gt;<br />
			    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tbody data-bind="^_this.prependItem(x21)"&gt;<br/>
			    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....<br/>
			    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tbody&gt;<br/>
			    &nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br/>
			    
			    <br/>
			    &nbsp;&nbsp;&nbsp;&nbsp;&lt;tbody data-bind="^_this.replaceItem(x22,x22.autocode)"&gt;<br/>
			    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....<br/>
			    &nbsp;&nbsp;&nbsp;&nbsp;&lt;/tbody&gt;<br/>
			    
			    
			    &lt;/form&gt;<br/>
			    <strong>manager.send("+","005930",formId,"x22");<br/>manager.send("+","005930",formId,"x21","chegyul-t");</strong>
	        </div>
	    </div>
	    <div style="clear: both;"></div>
	    <p>위와 같이 frm이라는 이름을 가지는 binder가 있고 manager.send를 통하여 이 binder에는 x21과 x22가 등록되었다. 하나의 실시간이 들어왔을때 적용범위는 binder 전체이다. 
	    그로 인해 x21이 실시간으로 들어 온다면 replaceItem에서 사용하는 x22는 데이터가 맞지 않아 오류가 발생(data-r-target과는 다른 문제)하게 된다. 이를 해결할 수 있는 방법이
	    data-realtime-zone을 설정하는 것이다. realtime-zone이 설정되면 binder영역 전체가 범위인 x22는 realtime-zone안쪽의 영역은 binding하지 않는다. 
	    대신 manager.send("+","005930",formId,"x21","chegyul-t")처럼 5번째 인자로 realtimezoneId를 입력하면 그 실시간은 realtimezone 안쪽의 bind element에만 binding한다.</p>
	</div>
</div>
</div>
<div id="preview" class="preview"></div><div id="htmlview"><textarea id="html" name="html" style="display: none;"><form id="frm">
    <ul class="jisu-ul">
        <li data-realtime-zone="juyojisu-1">
            <div>
                <div data-bind="c.block[0].jisuname"></div>
                <div data-bind="c.block[0].curjuka^x19.curjuka"></div>
                <div><span data-bind="DB_getColFlag(c.block[0].debi,c.block[0].debi_f)^DB_getColFlag(x19.debi,x19.debi_f)"></span> <span data-bind="DB_getColBuho(c.block[0].debirate)^DB_getColBuho(x19.debirate)"></span></div>
            </div>
        </li>
        <li data-realtime-zone="juyojisu-2">
            <div>
                <div data-bind="c.block[1].jisuname"></div>
                <div data-bind="c.block[1].curjuka^x19.curjuka"></div>
                <div><span data-bind="DB_getColFlag(c.block[1].debi,c.block[1].debi_f)^DB_getColFlag(x19.debi,x19.debi_f)"></span> <span data-bind="DB_getColBuho(c.block[1].debirate)^DB_getColBuho(x19.debirate)"></span></div>
            </div>
        </li>
        <li data-realtime-zone="juyojisu-3">
            <div>
                <div data-bind="c.block[2].jisuname"></div>
                <div data-bind="c.block[2].curjuka^x49.curjuka"></div>
                <div><span data-bind="DB_getColFlag(c.block[2].debi,c.block[2].debi_f)^DB_getColFlag(x14.debi,x14.debi_f)"></span> <span data-bind="DB_getColBuho(c.block[2].debirate)^DB_getColBuho(x49.debirate)"></span></div>
            </div>
        </li>
        <li data-realtime-zone="juyojisu-4">
            <div>
                <div data-bind="c.block[3].jisuname"></div>
                <div data-bind="c.block[3].curjuka^x60.curjuka"></div>
                <div><span data-bind="DB_getColFlag(c.block[3].debi,c.block[3].debi_f)^DB_getColFlag(x60.debi,x60.debi_f)"></span> <span data-bind="DB_getColBuho(c.block[3].debirate)^DB_getColBuho(x60.debirate)"></span></div>
            </div>
        </li>
        <li data-realtime-zone="juyojisu-5">
            <div>
                <div data-bind="c.block[4].jisuname"></div>
                <div data-bind="c.block[4].curjuka^x60.curjuka"></div>
                <div><span data-bind="DB_getColFlag(c.block[4].debi,c.block[4].debi_f)^DB_getColFlag(x60.debi,x60.debi_f)"></span> <span data-bind="DB_getColBuho(c.block[4].debirate)^DB_getColBuho(x60.debirate)"></span></div>
            </div>
        </li>
        <li data-realtime-zone="juyojisu-6">
            <div>
                <div data-bind="c.block[5].jisuname"></div>
                <div data-bind="c.block[5].curjuka^x60.curjuka"></div>
                <div><span data-bind="DB_getColFlag(c.block[5].debi,c.block[5].debi_f)^DB_getColFlag(x60.debi,x60.debi_f)"></span> <span data-bind="DB_getColBuho(c.block[5].debirate)^DB_getColBuho(x60.debirate)"></span></div>
            </div>
        </li>
    </ul>
    
    <div class="clear"></div>
    
    <div class="fl" data-realtime-zone="chegyul-t">
        <h2>prependItem</h2>
        <table style="width:350px">
            <caption>SK하이닉스 시간대별 체결 표(max-append:3)</caption>
            <thead>
                <tr>
                    <th scope="col">시간</th>
                    <th scope="col">현재가</th>
                    <th scope="col">전일비</th>
                    <th scope="col">등락율</th>
                    <th scope="col">체결량</th>
                </tr>
            </thead>
            <tbody data-bind="_this.listItem(b.block)^_this.prependItem(r)" data-max-item="^3">
                <tr data-bindkey="jongcode">
                    <td data-bind="time^time2"></td>
                    <td data-bind="curjuka^curjuka"></td>
                    <td data-bind="DB_getColFlag(debi,debi_f)^DB_getColFlag(debi,debi_f)"></td>
                    <td data-bind="DB_getColBuho(debirate)^DB_getColBuho(debirate)"></td>
                    <td data-bind="nowvol^nowvol"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="fr">
        <h2>replaceItem</h2>
        <table>
            <caption>관심종목에 대한 정보를 제공하는 표</caption>
            <thead>
                <tr>
                    <th scope="col">종목명</th>
                    <th scope="col">현재가</th>
                    <th scope="col">전일비</th>
                    <th scope="col">등락율</th>
                    <th scope="col">거래량</th>
                    <th scope="col">매도호가</th>
                    <th scope="col">매도잔량</th>
                    <th scope="col">매수호가</th>
                    <th scope="col">매수잔량</th>
                </tr>
            </thead>
            <tbody data-bind="_this.listItem(a.block)^_this.replaceItem(r,r.autocode)">
                <tr data-bindkey="jongcode">
                    <td data-bind="jongname"></td>
                    <td data-bind="curjuka^curjuka" data-r-target="x21"></td>
                    <td data-bind="DB_getColFlag(debi,debi_f)^DB_getColFlag(debi,debi_f)" data-r-target="x21"></td>
                    <td data-bind="DB_getColBuho(debirate)^DB_getColBuho(debirate)" data-r-target="x21"></td>
                    <td data-bind="volume^volume" data-r-target="x21"></td>
                    <td data-bind="medohoka^medohoka" data-r-target="x22"></td>
                    <td data-bind="medojan^medovol" data-r-target="x22"></td>
                    <td data-bind="mesuhoka^mesuhoka" data-r-target="x22"></td>
                    <td data-bind="mesujan^mesuvol" data-r-target="x22"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="clear"></div>
</form></textarea></div>

<div id="scriptview"><textarea id="script" name="script" style="display: none;"><script type="text/javascript">
    //임시 데이터
    var jsonData = {
        a:{
            block:[
                {jongcode:"005930",jongname:"삼성전자",curjuka:"1,137,000",debi:"10,000",debi_f:"2",debirate:"0.67",volume:"58,948",medohoka:"1,151,000",medojan:"1",mesuhoka:"1,150,000",mesujan:"135"},
                {jongcode:"122630",jongname:"KODEX 레버리지",curjuka:"12,120",debi:"135",debi_f:"5",debirate:"-1.13",volume:"11,600,333",medohoka:"9,130",medojan:"385",mesuhoka:"9,125",mesujan:"8235"},
                {jongcode:"000660",jongname:"SK하이닉스",curjuka:"31,700",debi:"300",debi_f:"2",debirate:"0.96",volume:"1,323,825",medohoka:"27,450",medojan:"825",mesuhoka:"27,000",mesujan:"185"}
            ]
        },
        
        b:{
            block:[
                {time:"09:00:03",curjuka:"26,900",debi:"135",debi_f:"2",debirate:"0.67",nowvol:"3"},
                {time:"09:00:02",curjuka:"26,800",debi:"135",debi_f:"2",debirate:"1.13",nowvol:"2"},
                {time:"09:00:01",curjuka:"26,900",debi:"300",debi_f:"2",debirate:"0.96",nowvol:"1"}
            ]
        },
        
        c:{
            block:[
                {jisuname: "KOSPI", curjuka: "1,901.09", debi: "3.22", debi_f:"2", debirate: "0.17", jisucode: "01"},
                {jisuname: "KOSDAQ", curjuka: "678.39", debi: "3.14", debi_f:"2", debirate: "0.47", jisucode: "001"},
                {jisuname: "KOSPI200", curjuka: "230.92", debi: "-0.04", debi_f:"5", debirate: "-0.02", jisucode: "0001"},
                {jisuname: "다우 산업", curjuka: "15,944.46", debi: "-222.77", debi_f:"5", debirate: "-1.38", jisucode: "DJI@DJI"},
                {jisuname: "나스닥 종합", curjuka: "4,468.17", debi: "-99.51", debi_f:"5", debirate: "-2.18", jisucode: "NAS@IXIC"},
                {jisuname: "상해종합", curjuka: "2,707.66", debi: "-27.90", debi_f:"5", debirate: "-1.02", jisucode: "SHS@000001"},
            ]
        }
    };

    var formId = "frm";
    
    var binder = manager.addBinder(formId,true);//해당 폼을 매니저에 등록
    binder.bind(jsonData);//jsonData를 해당 element에 binding
    
    
    
    
    //실시간 데이터 수신을 위한 웹소켓 연결
    startWebsocket();//websocketinfo.js
    
    //실시간 등록,해제함수  ([+|-],[실시간등록코드], [폼아이디], [실시간수신TR])
    var block = jsonData.a.block;
    var sendList = new Array();
    for( var i = 0, ic = block.length; i < ic; i++ ){
        sendList.push(block[i]["jongcode"]);
    }
    
    //5번째 인자가 없다면 realtime-zone을 제외한 전체 영역이 실시간 처리 된다.
    manager.send("+",sendList.join("|"),formId,"x21|x22");
    
    
    //5번째 인자로 data-realtime-zone 값을 설정하면 zone안의 실시간만 처리 된다.
    manager.send("+","000660",formId,"x21","chegyul-t");
    
    manager.send("+","0001",formId,"x19","juyojisu-1");
    manager.send("+","1001",formId,"x19","juyojisu-2");
    manager.send("+","0001",formId,"x49","juyojisu-3");
    manager.send("+","DJI@DJI",formId,"x60","juyojisu-4");
    manager.send("+","NAS@IXIC",formId,"x60","juyojisu-5");
    manager.send("+","SHS@000001",formId,"x60","juyojisu-6");
    
</script></textarea></div><div class="clear"></div></body></html>